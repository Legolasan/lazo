/* automatically generated by JSCoverage - do not edit */
try {
  if (typeof top === 'object' && top !== null && typeof top.opener === 'object' && top.opener !== null) {
    // this is a browser window that was opened from another window

    if (! top.opener._$jscoverage) {
      top.opener._$jscoverage = {};
    }
  }
}
catch (e) {}

try {
  if (typeof top === 'object' && top !== null) {
    // this is a browser window

    try {
      if (typeof top.opener === 'object' && top.opener !== null && top.opener._$jscoverage) {
        top._$jscoverage = top.opener._$jscoverage;
      }
    }
    catch (e) {}

    if (! top._$jscoverage) {
      top._$jscoverage = {};
    }
  }
}
catch (e) {}

try {
  if (typeof top === 'object' && top !== null && top._$jscoverage) {
    _$jscoverage = top._$jscoverage;
  }
}
catch (e) {}
if (typeof _$jscoverage !== 'object') {
  _$jscoverage = {};
}
if (! _$jscoverage['server/handlers/app/processor.js']) {
  _$jscoverage['server/handlers/app/processor.js'] = [];
  _$jscoverage['server/handlers/app/processor.js'][1] = 0;
  _$jscoverage['server/handlers/app/processor.js'][4] = 0;
  _$jscoverage['server/handlers/app/processor.js'][6] = 0;
  _$jscoverage['server/handlers/app/processor.js'][8] = 0;
  _$jscoverage['server/handlers/app/processor.js'][11] = 0;
  _$jscoverage['server/handlers/app/processor.js'][18] = 0;
  _$jscoverage['server/handlers/app/processor.js'][19] = 0;
  _$jscoverage['server/handlers/app/processor.js'][22] = 0;
  _$jscoverage['server/handlers/app/processor.js'][23] = 0;
  _$jscoverage['server/handlers/app/processor.js'][24] = 0;
  _$jscoverage['server/handlers/app/processor.js'][26] = 0;
  _$jscoverage['server/handlers/app/processor.js'][29] = 0;
  _$jscoverage['server/handlers/app/processor.js'][33] = 0;
  _$jscoverage['server/handlers/app/processor.js'][34] = 0;
  _$jscoverage['server/handlers/app/processor.js'][35] = 0;
  _$jscoverage['server/handlers/app/processor.js'][36] = 0;
  _$jscoverage['server/handlers/app/processor.js'][41] = 0;
  _$jscoverage['server/handlers/app/processor.js'][42] = 0;
  _$jscoverage['server/handlers/app/processor.js'][46] = 0;
  _$jscoverage['server/handlers/app/processor.js'][48] = 0;
  _$jscoverage['server/handlers/app/processor.js'][49] = 0;
  _$jscoverage['server/handlers/app/processor.js'][57] = 0;
  _$jscoverage['server/handlers/app/processor.js'][59] = 0;
  _$jscoverage['server/handlers/app/processor.js'][60] = 0;
  _$jscoverage['server/handlers/app/processor.js'][70] = 0;
  _$jscoverage['server/handlers/app/processor.js'][74] = 0;
  _$jscoverage['server/handlers/app/processor.js'][75] = 0;
  _$jscoverage['server/handlers/app/processor.js'][79] = 0;
  _$jscoverage['server/handlers/app/processor.js'][80] = 0;
  _$jscoverage['server/handlers/app/processor.js'][81] = 0;
  _$jscoverage['server/handlers/app/processor.js'][84] = 0;
  _$jscoverage['server/handlers/app/processor.js'][85] = 0;
  _$jscoverage['server/handlers/app/processor.js'][87] = 0;
  _$jscoverage['server/handlers/app/processor.js'][88] = 0;
  _$jscoverage['server/handlers/app/processor.js'][91] = 0;
  _$jscoverage['server/handlers/app/processor.js'][94] = 0;
  _$jscoverage['server/handlers/app/processor.js'][114] = 0;
  _$jscoverage['server/handlers/app/processor.js'][115] = 0;
  _$jscoverage['server/handlers/app/processor.js'][123] = 0;
  _$jscoverage['server/handlers/app/processor.js'][124] = 0;
  _$jscoverage['server/handlers/app/processor.js'][128] = 0;
  _$jscoverage['server/handlers/app/processor.js'][129] = 0;
  _$jscoverage['server/handlers/app/processor.js'][158] = 0;
  _$jscoverage['server/handlers/app/processor.js'][162] = 0;
  _$jscoverage['server/handlers/app/processor.js'][168] = 0;
  _$jscoverage['server/handlers/app/processor.js'][169] = 0;
  _$jscoverage['server/handlers/app/processor.js'][175] = 0;
  _$jscoverage['server/handlers/app/processor.js'][178] = 0;
  _$jscoverage['server/handlers/app/processor.js'][186] = 0;
}
_$jscoverage['server/handlers/app/processor.js'].source = ["define(['underscore', 'context', 'utils/loader', 'requestFilters', 'renderer', 'handlers/app/html', 'utils/document', 'bundler', 'jitc/main', 'handlers/utils'],","    function (_, Context, loader, filter, renderer, html, doc, Bundler, jitc, utils) {","","    'use strict';","","    var bundle = new Bundler();","","    return {","","        reply: function (path, params, options) {","            var self = this,","                redirect,","                cmpDef,","                ctx,","                hasLayoutChanged,","                cmpToLoad;","","            function onError(err) {","                return options.error(err);","            }","","            ctx = new Context(params);","            if ((redirect = filter.get(path, params, ctx))) {","                if (ctx.isXHR) {","                    // TODO: see if this can be reworked, it's implemented as a work around for the cross origin access issue","                    return options.success({redirect: redirect});","                }","                else {","                    return LAZO.app.navigate(ctx, redirect);","                }","            }","","            cmpDef = this._getCmpDef(params.svr._routes[path], LAZO.app.defaultLayout);","            hasLayoutChanged = cmpDef.layout &amp;&amp; cmpDef.layout !== params.layout;","            cmpToLoad = cmpDef.layout || cmpDef.name;","            loader(cmpToLoad, {","                ctx: ctx,","                action: cmpToLoad === cmpDef.layout ? 'index' : cmpDef.action,","                error: onError,","                success: function (ctl) {","                    if (cmpDef.layout) {","                        ctl.addChild('lazo-layout-body', cmpDef.name, {","                            params: ctx.params,","                            action: cmpDef.action,","                            success: function () {","                                return utils.getAssets(cmpDef.name, ctx, {","                                    success: function (assets) {","                                        utils.setAssets(ctl, assets);","                                        self._buildReply(ctl, ctx, params, assets, cmpDef, options);","                                    },","                                    error: onError","                                });","                            },","                            error: onError","                        });","                    } else {","                        return utils.getAssets(cmpDef.name, ctx, {","                            success: function (assets) {","                                utils.setAssets(ctl, assets);","                                self._buildReply(ctl, ctx, params, assets, cmpDef, options);","                            },","                            error: onError","                        });","                    }","                }","            });","        },","","        _buildReply: function (ctl, ctx, params, assets, cmpDef, options) {","            var cookies = ctx._rootCtx.cookies,","                self = this,","                response;","","            function buildHtmlResponse(rootCtx) {","                var link,","                    i,","                    tags;","","                    doc.setTitle(ctl.getPageTitle());","                    tags = _.map(doc.getTags(), function (tag) {","                        return _.clone(tag);","                    });","","                function getPaths() {","                    var errTempPaths = {};","","                    _.each(LAZO.errorTemplates, function (tmpDef, key) {","                        errTempPaths['' + key] = tmpDef.client;","                    });","","                    return _.extend(LAZO.contexts.app.paths || {}, errTempPaths);","                }","","                return html({","                    layout: cmpDef.layout || '',","                    body: renderer.getHtml(ctl),","                    rootCtl: ctl.serialize(),","                    rootCtx: JSON.stringify(rootCtx),","                    dependencies: ctx._rootCtx.dependencies,","                    tags: tags,","                    htmlTag: doc.getHtmlTag(),","                    bodyClass: doc.getBodyClass(),","                    // DO NOT COMBO HANDLE","                    lib: false,","                    // BEGIN disable combo handling","                    // lib: cookies &amp;&amp; cookies.development === '1' ? false : bundle.getLibPath(),","                    // END disable combo handling","                    shim: JSON.stringify(LAZO.contexts.app.shim || {}),","                    paths: JSON.stringify(getPaths()),","                    args: LAZO.app.args ? JSON.stringify(LAZO.app.args) : '{}'","                });","            }","","            function buildJsonResponse(rootCtx) {","                return {","                    root: rootCtx,","                    component: ctl.toJSON(),","                    layout: cmpDef.layout","                };","            }","","            // entry point","            (function (self) {","                var rootCtx = utils.getRootCtxForReply(ctx, assets),","                    cmpBundles = jitc.buildComponentBundleDef(renderer.getList('component', ctl));","","                // DO NOT COMBO HANDLE","                ctx._rootCtx.dependencies.css = LAZO.app.css.slice(0).concat(ctx._rootCtx.dependencies.css);","                return options.success(ctx.isXHR ? buildJsonResponse(rootCtx) : buildHtmlResponse(rootCtx));","","                // BEGIN disable combo handling","                // if (cookies &amp;&amp; cookies.development === '1') {","                //     ctx._rootCtx.dependencies.css = LAZO.app.css.slice(0).concat(ctx._rootCtx.dependencies.css);","                //     return options.success(ctx.isXHR ? buildJsonResponse(rootCtx) : buildHtmlResponse(rootCtx));","                // }","","                // bundle.create(ctl.ctx.location.path, {","                //     components: cmpBundles,","                //     app: {","                //         css: LAZO.app.css,","                //         js: ['app/application'].concat(LAZO.app.js)","                //     },","                //     loaded: params.exclude,","                //     type: 'application_navigate',","                //     controller: cmpDef.name,","                //     action: cmpDef.action","                // }, function (modules) {","                //     rootCtx.dependencies.modules = modules.js;","                //     rootCtx.dependencies.css = modules.css;","                //     options.success(ctx.isXHR ? buildJsonResponse(rootCtx) : buildHtmlResponse(rootCtx));","                // });","                // END disable combo handling","","            })(this);","        },","","        _include: function (rootCtx, exclude, isXHR) {","            return _.difference(_.uniq(rootCtx.modules), exclude).sort();","        },","","        _getCmpDef: function (comp, defaultLayout) {","            var isObj,","                name = (isObj = _.isObject(comp)) ? comp.component : comp,","                compParts = name.split('#'),","                action,","                layout;","","            name = compParts.length ? compParts[0] : name;","            action = compParts.length &amp;&amp; compParts[1] ? compParts[1] : 'index';","            // possible scenarios","            // 1. no layout: comp is a string, e.g. foo#baz, foo","            // 2. layout: comp is an object with a layout","            // 3. default layout and layout: comp is an object, app has a default layout","            // 4. default layout and layout === false: comp is an object, app has a default layout, but route def comp.layout = false","            layout = (isObj &amp;&amp; comp.layout) ? comp.layout : (defaultLayout &amp;&amp; !isObj || isObj &amp;&amp; !_.isBoolean(comp.layout)) ?","                defaultLayout : null;","","            return {","                name: name,","                action: action,","                layout: layout","            };","        },","","        _hasLayoutChanged: function () {","            return LAZO.app.isClient &amp;&amp; window.rootCtl &amp;&amp; layout === window.rootCtl.name ? false : true;","        }","","    };","","});"];
_$jscoverage['server/handlers/app/processor.js'][1]++;
define(["underscore", "context", "utils/loader", "requestFilters", "renderer", "handlers/app/html", "utils/document", "bundler", "jitc/main", "handlers/utils"], (function (_, Context, loader, filter, renderer, html, doc, Bundler, jitc, utils) {
  _$jscoverage['server/handlers/app/processor.js'][4]++;
  "use strict";
  _$jscoverage['server/handlers/app/processor.js'][6]++;
  var bundle = new Bundler();
  _$jscoverage['server/handlers/app/processor.js'][8]++;
  return ({reply: (function (path, params, options) {
  _$jscoverage['server/handlers/app/processor.js'][11]++;
  var self = this, redirect, cmpDef, ctx, hasLayoutChanged, cmpToLoad;
  _$jscoverage['server/handlers/app/processor.js'][18]++;
  function onError(err) {
    _$jscoverage['server/handlers/app/processor.js'][19]++;
    return options.error(err);
}
  _$jscoverage['server/handlers/app/processor.js'][22]++;
  ctx = new Context(params);
  _$jscoverage['server/handlers/app/processor.js'][23]++;
  if ((redirect = filter.get(path, params, ctx))) {
    _$jscoverage['server/handlers/app/processor.js'][24]++;
    if (ctx.isXHR) {
      _$jscoverage['server/handlers/app/processor.js'][26]++;
      return options.success({redirect: redirect});
    }
    else {
      _$jscoverage['server/handlers/app/processor.js'][29]++;
      return LAZO.app.navigate(ctx, redirect);
    }
  }
  _$jscoverage['server/handlers/app/processor.js'][33]++;
  cmpDef = this._getCmpDef(params.svr._routes[path], LAZO.app.defaultLayout);
  _$jscoverage['server/handlers/app/processor.js'][34]++;
  hasLayoutChanged = (cmpDef.layout && (cmpDef.layout !== params.layout));
  _$jscoverage['server/handlers/app/processor.js'][35]++;
  cmpToLoad = (cmpDef.layout || cmpDef.name);
  _$jscoverage['server/handlers/app/processor.js'][36]++;
  loader(cmpToLoad, {ctx: ctx, action: ((cmpToLoad === cmpDef.layout)? "index": cmpDef.action), error: onError, success: (function (ctl) {
  _$jscoverage['server/handlers/app/processor.js'][41]++;
  if (cmpDef.layout) {
    _$jscoverage['server/handlers/app/processor.js'][42]++;
    ctl.addChild("lazo-layout-body", cmpDef.name, {params: ctx.params, action: cmpDef.action, success: (function () {
  _$jscoverage['server/handlers/app/processor.js'][46]++;
  return utils.getAssets(cmpDef.name, ctx, {success: (function (assets) {
  _$jscoverage['server/handlers/app/processor.js'][48]++;
  utils.setAssets(ctl, assets);
  _$jscoverage['server/handlers/app/processor.js'][49]++;
  self._buildReply(ctl, ctx, params, assets, cmpDef, options);
}), error: onError});
}), error: onError});
  }
  else {
    _$jscoverage['server/handlers/app/processor.js'][57]++;
    return utils.getAssets(cmpDef.name, ctx, {success: (function (assets) {
  _$jscoverage['server/handlers/app/processor.js'][59]++;
  utils.setAssets(ctl, assets);
  _$jscoverage['server/handlers/app/processor.js'][60]++;
  self._buildReply(ctl, ctx, params, assets, cmpDef, options);
}), error: onError});
  }
})});
}), _buildReply: (function (ctl, ctx, params, assets, cmpDef, options) {
  _$jscoverage['server/handlers/app/processor.js'][70]++;
  var cookies = ctx._rootCtx.cookies, self = this, response;
  _$jscoverage['server/handlers/app/processor.js'][74]++;
  function buildHtmlResponse(rootCtx) {
    _$jscoverage['server/handlers/app/processor.js'][75]++;
    var link, i, tags;
    _$jscoverage['server/handlers/app/processor.js'][79]++;
    doc.setTitle(ctl.getPageTitle());
    _$jscoverage['server/handlers/app/processor.js'][80]++;
    tags = _.map(doc.getTags(), (function (tag) {
  _$jscoverage['server/handlers/app/processor.js'][81]++;
  return _.clone(tag);
}));
    _$jscoverage['server/handlers/app/processor.js'][84]++;
    function getPaths() {
      _$jscoverage['server/handlers/app/processor.js'][85]++;
      var errTempPaths = {};
      _$jscoverage['server/handlers/app/processor.js'][87]++;
      _.each(LAZO.errorTemplates, (function (tmpDef, key) {
  _$jscoverage['server/handlers/app/processor.js'][88]++;
  errTempPaths[("" + key)] = tmpDef.client;
}));
      _$jscoverage['server/handlers/app/processor.js'][91]++;
      return _.extend((LAZO.contexts.app.paths || {}), errTempPaths);
}
    _$jscoverage['server/handlers/app/processor.js'][94]++;
    return html({layout: (cmpDef.layout || ""), body: renderer.getHtml(ctl), rootCtl: ctl.serialize(), rootCtx: JSON.stringify(rootCtx), dependencies: ctx._rootCtx.dependencies, tags: tags, htmlTag: doc.getHtmlTag(), bodyClass: doc.getBodyClass(), lib: false, shim: JSON.stringify((LAZO.contexts.app.shim || {})), paths: JSON.stringify(getPaths()), args: (LAZO.app.args? JSON.stringify(LAZO.app.args): "{}")});
}
  _$jscoverage['server/handlers/app/processor.js'][114]++;
  function buildJsonResponse(rootCtx) {
    _$jscoverage['server/handlers/app/processor.js'][115]++;
    return ({root: rootCtx, component: ctl.toJSON(), layout: cmpDef.layout});
}
  _$jscoverage['server/handlers/app/processor.js'][123]++;
  (function (self) {
  _$jscoverage['server/handlers/app/processor.js'][124]++;
  var rootCtx = utils.getRootCtxForReply(ctx, assets), cmpBundles = jitc.buildComponentBundleDef(renderer.getList("component", ctl));
  _$jscoverage['server/handlers/app/processor.js'][128]++;
  ctx._rootCtx.dependencies.css = LAZO.app.css.slice(0).concat(ctx._rootCtx.dependencies.css);
  _$jscoverage['server/handlers/app/processor.js'][129]++;
  return options.success((ctx.isXHR? buildJsonResponse(rootCtx): buildHtmlResponse(rootCtx)));
})(this);
}), _include: (function (rootCtx, exclude, isXHR) {
  _$jscoverage['server/handlers/app/processor.js'][158]++;
  return _.difference(_.uniq(rootCtx.modules), exclude).sort();
}), _getCmpDef: (function (comp, defaultLayout) {
  _$jscoverage['server/handlers/app/processor.js'][162]++;
  var isObj, name = ((isObj = _.isObject(comp))? comp.component: comp), compParts = name.split("#"), action, layout;
  _$jscoverage['server/handlers/app/processor.js'][168]++;
  name = (compParts.length? compParts[0]: name);
  _$jscoverage['server/handlers/app/processor.js'][169]++;
  action = ((compParts.length && compParts[1])? compParts[1]: "index");
  _$jscoverage['server/handlers/app/processor.js'][175]++;
  layout = ((isObj && comp.layout)? comp.layout: (((defaultLayout && (! isObj)) || (isObj && (! _.isBoolean(comp.layout))))? defaultLayout: null));
  _$jscoverage['server/handlers/app/processor.js'][178]++;
  return ({name: name, action: action, layout: layout});
}), _hasLayoutChanged: (function () {
  _$jscoverage['server/handlers/app/processor.js'][186]++;
  return ((LAZO.app.isClient && window.rootCtl && (layout === window.rootCtl.name))? false: true);
})});
}));
